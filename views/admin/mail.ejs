
<!-------------------------------------------- home -->
<div class="container mt-4">
    <h2>Category Offers</h2>
    <div class="row">
        <!-- Category 1 Offer -->
        <% categoryinfo.forEach(data => { %>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card" style="height: 400px; width: 100%;">

                <div class="card-img-top" style="background-image: url('/uploads/<%= data.Image %>'); background-size: cover; background-repeat: no-repeat; background-position: center center; height: 70%;"></div>

                <div class="card-body">
                    <h5 class="card-title" style="color: rgb(7, 9, 0); font-size: 1.5rem;"><%= data.Category %></h5>
                 <div class="card-text">
         <p class="text-success"><strong>Save up to <%= data.Discount %>%</strong></p>
             </div>

             <a href="/categorybasedrender/<%= data._id %>" class="btn btn-success">Shop Now</a>

                </div>
            </div>
        </div>
        <% }) %>
    </div>
</div>


<!--sort-->
<div class="container mt-5" >
    <div class="section-title">
        <h5>SORT ALL</h5>
    </div> 
<div class="col-md-3">
    <!-- Sorting Dropdown -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="sortDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sort By
        </button>
        <div class="dropdown-menu" aria-labelledby="sortDropdown">
            <a class="sort-dropdown-item" href="/home?page=<%= currentPage %>&sort=0" data-sort="lowToHigh">Low to High</a>
            <a class="sort-dropdown-item" href="/home?page=<%= currentPage %>&sort=1" data-sort="highToLow">High to Low</a>
        </div>
    </div>
</div>
</div> 

<section class="shop spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="shop__sidebar">
                     
                     <!-- Sorting  -->
                        <!-- <div class="sidebar__filter">
                            <div class="section-title">
                                <h4>sort all</h4>
                            </div> -->
                            <!-- <div class="filter-range-wrap">
                                <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
                                data-min="33" data-max="99"></div>
                                <div class="range-slider">
                                    <div class="price-input">
                                        <p>Price:</p>
                                        <input type="text" id="minamount">
                                        <input type="text" id="maxamount">
                                    </div>
                                </div>
                            </div>
                            <a href="#">Filter</a> -->
                        <!-- </div>     -->

  <!-- Brand  -->
                        <div class="sidebar__categories">
                            <div class="section-title">
                                <h4>Brands</h4>
                            </div>
                            <div class="categories__accordion">
                        
                               
    <!-- Brand Dropdown -->
       <div class="col-md-3">
       <div class="dropdow">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="brandDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Brand
        </button>
        <div class="dropdown-menu" aria-labelledby="brandDropdown">
            <% prodectinfo.forEach(data=> { %>
            <a class="dropdown-items" href="/home?brand=<%=data.Brand %>" data-brand="brand1"><%=data.Brand %></a>
        <% }) %>
        </div>
            </div>
            </div>

       </div>
           </div>
                   
                        

<!-- Price-based  -->
                        <div class="sidebar__sizes">
                            <div class="section-title">
                                <h4>Shop by price</h4>
                            </div>
                            <!-- <div class="size__list">
                                <label for="xxs">
                                    xxs
                                    <input type="checkbox" id="xxs">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="xs">
                                    xs
                                    <input type="checkbox" id="xs">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="xss">
                                    xs-s
                                    <input type="checkbox" id="xss">
                                    <span class="checkmark"></span>
                                </label>
                               
                            </div> -->
                             
                            <div class="col-md-3">
                                <!-- Price-based Dropdown -->
                                <div class="dropdo">
                                    <button class="btn btn-secondary dropdown-toggle" type="button" id="priceDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Price
                                    </button>
                                    <div class="dropdown-menu" aria-labelledby="priceDropdown">
                                        <a class="dropdown-items" href="/home?page=<%= currentPage %>&sprice=0&eprice=1000" data-price="under20"> under and 1000 </a>
                                        <a class="dropdown-items" href="//home?page=<%= currentPage %>&sprice=1000&eprice=2000" data-price="20to50">1000 - 2000</a>
                                        <a class="dropdown-items" href="//home?page=<%= currentPage %>&sprice=2000&eprice=60000" data-price="50plus">Over 60000</a>
                                    </div>
                                </div>
                            </div>
                    </div>
                       
                        <!-- <div class="sidebar__color">
                            <div class="section-title">
                                <h4>Shop by size</h4>
                            </div>
                            <div class="size__list color__list">
                                <label for="black">
                                    Blacks
                                    <input type="checkbox" id="black">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="whites">
                                    Whites
                                    <input type="checkbox" id="whites">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="reds">
                                    Reds
                                    <input type="checkbox" id="reds">
                                    <span class="checkmark"></span>
                                </label>
                                </div>
                            </div> -->
                            
                            <a href="/home">
                                <button class="" type="button">Clear</button>
                            </a>              
                    </div>
                </div>
                
    <div class="col-lg-9 col-md-9">
    <div class="row">
                        
                         <!--prodect displaying-->
 <section class="w-100">
    <div class="container ">
        <h3>All Products</h3>
        <div class="row">
            <% prodectinfo.forEach(data => { %>

                <% if(data.Quantity<=0){ %>
                    <div class="col-lg-4 col-md-7 col-sm-7 d-flex">
                        <a href="/oneprodectdetails/<%= data._id %>">
                            <div class="card w-100 my-1 shadow-2-strong position-relative">
                                <img src="/uploads/<%= data.Image[0] %>" alt="Product Image" width="200" height="210" />
                                <div class="card-body d-flex flex-column">
                                    <h6><a href="#"><%= data.Brand %></a></h6>
                                    <h6><a href="#"><%= data.Model %></a></h6>
                                    <h6><a href="#"><%= data.Description %></a></h6>
                    
                                    <!-- Add the 'bg-blur' class to blur the background -->
                                    <div class="label stockout stockblue bg-blur">
                                        <span class="text-danger font-weight-bold" style="font-size: medium;">Out Of Stock</span>
                                    </div>
                                    
                                    
                    
                                    <div class="offer__price text-primary">
                                        <span class="font-weight-bold text-dark"> Price: â‚¹<%= data.Price %></span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    
                <%}else{%>
                
                <div class="col-lg-4 col-md-7 col-sm-7 d-flex">
                    <a href="/oneprodectdetails/<%= data._id %>">
                        <div class="card w-100 my-1 shadow-2-strong position-relative">
                            <!-- Discount Sticker -->
                            <% if (data.Discount > 0) { %>
                                <div class="offer-sticker position-absolute top-0 end-0 rounded-pill bg-primary text-white px-2 py-1">
                                    <%= data.Discount %> %OFF
                                </div>
                                
                                
                            <% } %>

                            <img src="uploads/<%= data.Image[0] %>" alt="Product Image" width="200" height="210" />
                            <div class="card-body d-flex flex-column">
                                <h6><a href="#"><%= data.Brand %></a></h6>
                                <h6><a href="#"><%= data.Model %></a></h6>
                                <h6><a href="#"><%= data.Description %></a></h6>
                                <% if (data.Discount) { %>
                                <!-- Display the original price -->
                                <div class="product__price">
                                    <span class="text-muted">Price: â‚¹
                                        <s><%= data.Price %></s></span>
                                </div>
                                
                                <!-- Display the offer price -->
                                <div class="offer__price text-danger text-light bg-dark">
                                    <span class="font-weight-bold">Offer Price: â‚¹<%= data.OfferPrice %></span>
                                </div>
                                
                                
                                
                                <% }else{ %>
                                    <div class="offer__price text-primary">
                                        <span class="font-weight-bold text-dark"> Price: â‚¹<%= data.Price %></span>
                                    </div>
                                    
                                    
                                <% } %>
                                <!-- Display the offer percentage -->
                                <!-- <div class="offer__percentage">
                                    <= data.Discount %> off
                                </div> -->

                                <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
                                    <a href="/cartpage/<%= data._id %>" class="btn btn-success shadow-0 me-1">Add to cart</a>
                                    <a href="/wishlistpost/<%= data._id %>" class="btn btn-warning shadow-0 me-1">Wishlist</a>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <% } %>
            <% }) %>
        </div>
    </div>
</section>
                        
             
                        
                        <!--pagination process-->
                        <div class="col-lg-12 text-center">
                          <!-- Pagination links -->
                                    <nav aria-label="Page navigation">
                                        <ul class="pagination justify-content-center"> <!-- Added justify-content-center class -->
                                            <% if (currentPage > 1) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage - 1 %>" aria-label="Previous">
                                                        <span aria-hidden="true">&laquo;</span>
                                                        <span class="sr-only">Previous</span>
                                                    </a>
                                                </li>
                                            <% } %>
                                            
                                            <% for (let i = 1; i <= totalPages; i++) { %>
                                                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                                </li>
                                            <% } %>
                                            
                                            <% if (currentPage < totalPages) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                                                        <span aria-hidden="true">&raquo;</span>
                                                        <span class="sr-only">Next</span>
                                                    </a>
                                                </li>
                                            <% } %>
                                        </ul>
                                    </nav>
                                </div>
                    
                    </div>
                </div>
            </div>
        </div>
    



 <section class="trend spad">
            <div class="container">
                <div class="row">

                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="trend__content">
                            <div class="section-title">
                                <h4>Hot Trend</h4>
                            </div>

                            <div class="trend__item">
                                <div class="trend__item__pic">
                                    <img src="img/trend/saas.jpg" alt="">
                                </div>
                                <div class="trend__item__text">
                                    <h6>IPhone 6GB/128</h6>
                                    <!-- <div class="rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div> -->
                                    <div class="product__price">$ 59.0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="trend__content">
                            <div class="section-title">
                                <h4>Best seller</h4>
                            </div>
                            <div class="trend__item">
                                <div class="trend__item__pic">
                                    <img src="img/trend/sxgfdfg.jpg" alt="">
                                </div>
                                <div class="trend__item__text">
                                    <h6>Cotton T-Shirt</h6>
                                    <!-- <div class="rating">
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                </div> -->
                                    <div class="product__price">$ 59.0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            </div>
        </section>



        <!-- Services Section Begin -->
        <section class="services spad">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="services__item">
                            <i class="fa fa-car"></i>
                            <h6>Free Shipping</h6>
                            <p>For all oder over $99</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="services__item">
                            <i class="fa fa-money"></i>
                            <h6>Money Back Guarantee</h6>
                            <p>If good have Problems</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="services__item">
                            <i class="fa fa-support"></i>
                            <h6>Online Support 24/7</h6>
                            <p>Dedicated support</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="services__item">
                            <i class="fa fa-headphones"></i>
                            <h6>Payment Secure</h6>
                            <p>100% secure payment</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Services Section End -->



        <!--footer-->
        <%- include('./partials/footer.ejs') %>
            <!--footer-->




            <!-- Js Plugins -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

            <script src="js/jquery-3.3.1.min.js"></script>
            <script src="js/bootstrap.min.js"></script>
            <script src="js/jquery.magnific-popup.min.js"></script>
            <script src="js/jquery-ui.min.js"></script>
            <script src="js/mixitup.min.js"></script>
            <script src="js/jquery.countdown.min.js"></script>
            <script src="js/jquery.slicknav.js"></script>
            <script src="js/owl.carousel.min.js"></script>
            <script src="js/jquery.nicescroll.min.js"></script>
            <script src="js/main.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
           
           
           
           
           
           <script>
                $(document).ready(function() {
                    $('.dropdown-item').click(function(e) {
                        e.preventDefault();
                        
                        // Determine the selected criteria
                        var selectedSort = $(this).data('sort');
                        var selectedBrand = $(this).data('brand');
                        var selectedPrice = $(this).data('price');
                        
                        // Apply the sorting and filtering logic here
                        // You can use if statements or switch cases to implement sorting and filtering
                        
                        // Example: Sorting by Price
                        if (selectedSort === 'lowToHigh') {
                            // Sort items from low to high
                            // Implement your sorting logic
                        } else if (selectedSort === 'highToLow') {
                            // Sort items from high to low
                            // Implement your sorting logic
                        }
                        
                        // Example: Filtering by Brand
                        if (selectedBrand) {
                            // Show items with the selected brand
                            // Implement your filtering logic
                        }
                        
                        // Example: Filtering by Price
                        if (selectedPrice === 'under20') {
                            // Show items with a price under $20
                            // Implement your filtering logic
                        } else if (selectedPrice === '20to50') {
                            // Show items with a price between $20 and $50
                            // Implement your filtering logic
                        } else if (selectedPrice === '50plus') {
                            // Show items with a price over $50
                            // Implement your filtering logic
                        }
                    });
                });
            </script>
            <script>
                // Get a reference to the dropdown menu and button
const dropdown = document.querySelector(".dropdown");
const sort_dropdown_item = document.querySelectorAll(".sort-dropdown-item");


            </script>



</body>
<!-----///////----------------------------------------- home -->
<!-- add product -->

<div class="mb-3">
    <label for="Brand" class="form-label text-white">Brand</label>
    <input type="text" class="form-control text-white" id="Brand" name="Brand">
  </div>

  <div class="mb-3">
    <label for="Model" class="form-label text-white">Model</label>
    <input type="text" class="form-control text-white" id="Model" name="Model">
  </div>

  <div class="mb-3">
    <label for="Image" class="form-label text-white">Image</label>
    <input type="file" class="form-control" id="Image" name="Image" multiple>
  </div>

  <div class="mb-3">
    <label for="Description" class="form-label text-white">Description</label>
    <input type="text" class="form-control text-white" id="Description" name="Description">
  </div>

  <div class="mb-3">
    <label for="Quantity" class="form-label text-white">Quantity</label>
    <input type="text" class="form-control text-white" id="Quantity" name="Quantity">
  </div>

  <div class="mb-3">
    <label for="Price" class="form-label text-white">Price</label>
    <input type="text" class="form-control text-white" id="Price" name="Price">
  </div>

  <div class="mb-3">
    <label for="OfferPrice" class="form-label text-white">Offer Price</label>
    <input type="text" class="form-control text-white" id="OfferPrice" name="OfferPrice">
  </div>

  <div class="mb-3">
    <label for="Discount" class="form-label text-white">Discount</label>
    <input type="text" id="Discount" name="Discount" readonly>%
  </div>

  <button type="submit" class="btn btn-success">Add Products</button>
</form>
</div>
</div>
<!--Prodect add Form  end-->
</div>
<!-- add product -->

<!----------------cart page --------------->
<script>
    const cartpagedetails = async (req, res) => {
    const userdetails = req.session.userId;
    const Userlogin = true;
    const Username = userdetails.username ? userdetails.username : " ";

    try {
        const categoryinfo = await Categorycollection.find({});
        const cartinfo = await CartCollection.find({ UserId: userdetails._id })
        console.log('cartinfo', cartinfo);

        let totalprice = 0;
        cartinfo.forEach((cartiteam) => {
            console.log('cartitem count', cartiteam.Count);
            if (cartiteam.OfferPrice) {
                totalprice += cartiteam.OfferPrice * cartiteam.Count;
            } else {
                totalprice += cartiteam.Price * cartiteam.Count;
            }
        })
        console.log('tatal price backend ', totalprice);


        return res.render("User/Shoppingcartpage", { Username, Userlogin, categoryinfo, cartinfo, totalprice })
    } catch (error) {
        console.log("Error due to cart detail displaying time:", error)
        return res.status(500).send("Error due to cart detail displaying time")
    }
}
</script>
<!----------------cart page --------------->

