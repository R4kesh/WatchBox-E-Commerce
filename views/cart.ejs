<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WatchBox_Luxury Watches A Ecommerce Category Flat Bootstrap Resposive Website </title>
	<link rel="stylesheet" href="/cart.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/html-minifier/4.0.0/htmlminifier.min.js">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/html-minifier/4.0.0/htmlminifier.js">
	<style>
		
/* CSS */
.button-85 {
  padding: 0.4em 1.5em; /* Adjusted padding for a smaller button */
  font-size: 14px; /* Adjusted font size */
  border: none;
  outline: none;
  color: rgb(255, 255, 255);
  background: #111;
  cursor: pointer;
  position: relative;
  z-index: 0;
  border-radius: 10px;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-85:before {
  content: "";
  background: linear-gradient(
    45deg,
    #ff0000,
    #ff7300,
    #fffb00,
    #48ff00,
    #00ffd5,
    #002bff,
    #7a00ff,
    #ff00c8,
    #ff0000
  );
  position: absolute;
  top: -2px;
  left: -2px;
  background-size: 400%;
  z-index: -1;
  filter: blur(5px);
  -webkit-filter: blur(5px);
  width: calc(100% + 1px);
  height: calc(100% + 1px);
  animation: glowing-button-85 20s linear infinite;
  transition: opacity 0.3s ease-in-out;
  border-radius: 10px;
}

@keyframes glowing-button-85 {
  0% {
    background-position: 0 0;
  }
  50% {
    background-position: 400% 0;
  }
  100% {
    background-position: 0 0;
  }
}

.button-85:after {
  z-index: -1;
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  background: #222;
  left: 0;
  top: 0;
  border-radius: 10px;
}

.offer-applied {
        border-color: red;
    }


	</style>
</head>
<body>
	




<header>
	<!-- Jumbotron -->
	<div class="p-3 text-center bg-white border-bottom">
	  <div class="container">
		<div class="row gy-3">
		  <!-- Left elements -->
		  <div class="col-lg-2 col-sm-4 col-4">
			<h1>WatchBox</h1>
			<!-- <a href="https://mdbootstrap.com/" target="_blank" class="float-start">
			  <img src="https://mdbootstrap.com/img/logo/mdb-transaprent-noshadows.png" height="35" />
			</a> -->
		  </div>
		 
		  <div class="col-lg-5 col-md-12 col-12">
			
		  </div>
		  <!-- Right elements -->
		</div>
	  </div>
	</div>
	<!-- Jumbotron -->
  
	<!-- Heading -->
	<div class="bg-black">
	  <div class="container py-4" style="color: black;">
		<!-- Breadcrumb -->
		<nav class="d-flex">
		  <h6 class="mb-0">
			<a href="/" class="text-white-50">Home</a>
			<span class="text-white-50 mx-2"> > </span>
			<a href="" class="text-white"><u>Shopping cart</u></a>
		  </h6>
		</nav>
		<!--Breadcrumb-->
	  </div>
	</div>
	<div class="bg-white animated-bg-grey">
		<div class="container">
			<h2>Coupon Codes</h2>
			<table>
			  <thead>
				<tr>
				  <th></th>
				  
				</tr>
			  </thead>
			  <tbody>
				<tr>
				  <td>Get ₹500 off* on purchase above ₹4999</td>
				  <td>&nbsp&nbsp&nbsp&nbsp&nbsp</td>
				  <td>Get ₹200 off* on purchase above ₹3000</td>
				</tr>
				<tr>
				  
				  <td><button class="button-85" role="button" type="button" onclick="copyCouponCode(500)">Claim Code</button></td>
				  <td>&nbsp&nbsp&nbsp&nbsp&nbsp</td>
				  <td><button class="button-85" role="button" type="button" onclick="copyCouponCod(200)">Claim Code</button></td>
				</tr>
			  </tbody>
			</table>
		  </div>
		
		
	</div>


	<!-- HTML !-->


	
	<!-- Heading -->
  </header>
  
  <!-- cart + summary -->
  <!-- cart + summary -->
<section class="bg-light my-5">
  <div class="container">
    <div class="row">
      <!-- cart -->
      <div class="col-lg-9">
        <div class="card border shadow-0">
          <div class="m-4">
			<% if (cartItems.length === 0) { %>
				<h1>Cart is Empty</h1>
            
			
				<% } else { %>
					<h4 class="card-title mb-4">Your shopping cart</h4>
			<%total=0%>
            <% cartItems.forEach(item => { %>
              <div class="row gy-3 mb-4">
                <div class="col-lg-5">
                  <div class="me-lg-5">
                    <div class="d-flex">
                      <img src="/productimg/<%= item.product.image.length> 0 ? item.product.image[0] : 'default-image.jpg' %>" class="border rounded me-3" style="width: 96px; height: 96px;" />
                      <div class="">
                        <a href="#" class="nav-link">
                          <h3><%= item.product.name %></h3>
                        </a>
                        <p class="text-muted">Category: <%= item.product.category %></p>
						<!-- <p class="text-muted" >Quantity:</p> -->
                      </div>
                    </div>
                  </div>
                </div>
				

				


                <div class="col-lg-2 col-sm-6 col-6 d-flex flex-row flex-lg-column flex-xl-row text-nowrap">
                 

					
					<form>
						<div class="quantity-selector">
						<div class="value-button" id="decrease_<%=item.product._id%>" onclick="decreaseValue('<%=item.product._id%>','<%= item.product.price %>')" value="Decrease Value">-</div>
						<input type="number" id="number_<%=item.product._id%>" value="<%=item.quantity%>" />
						<div class="value-button" id="increase_<%=item.product._id%>" onclick="increaseValue('<%=item.product._id%>','<%= item.product.price %>')" value="Increase Value">+</div>
						
					</div>
					  </form>

                  <div class="">
					<%if(item.product.OfferPrice){%>
                    <text class="h5">Price:₹<s><%= item.product.price%></s>  &#8377;<%= item.product.OfferPrice %></text> <br />
					<% }else{ %>%>
						<text class="h5">Price:₹<%= item.product.price%></text>
						<% } %>	
                  </div>
                </div>

				
                <div class="col-lg col-sm-6 d-flex justify-content-sm-center justify-content-md-start justify-content-lg-center justify-content-xl-end mb-2">
                  <div class="float-md-end">
                    
                    <a href="/cart/remove/<%=item.product._id%>" class="btn btn-light border text-danger icon-hover-danger"> Remove</a>
                  </div>
                </div>
              </div>
			  
			    <br />
				<%productPrice=item.product.price%>
                <%offerPrices=item.product.OfferPrice%>
				<%total+=(offerPrices > 0 ? offerPrices : productPrice)*item.quantity%>
				<% }); %>
				<!--------------------------------------------------------->
          </div>
          <!-- Other cart details can be added here -->
        </div>
      </div>
	  
	  <div class="col-lg-3">
				<div class="card shadow-0 border">
		  <div class="card-body">
			
				<!-- Add these changes inside the form tag -->
				<form id="couponadd">
					<div class="form-group">
						<label class="form-label">Have coupon?</label>
						<div class="input-group">
							<input type="text" class="form-control border" id="couponid" name="couponid" placeholder="<%= cartItems[0].product.OfferPrice ? 'Coupon not applicable (Offer applied)' : 'Coupon code' %>" <% if (cartItems[0].product.OfferPrice) { %> disabled <% } %> />
							<button class="btn btn-light border" type="button" id="buttons" <% if (cartItems[0].product.OfferPrice) { %>disabled<% } %>>Apply</button>
						</div>
						<div class="alert alert-success mt" role="alert" id="success-message" style="display: none;">
							Coupon applied successfully!
						</div>
						<div class="alert text-danger mt" role="alert" id="error-message">
							<% if (typeof errorMessage !== 'undefined' && errorMessage !== null) { %>
								<%= errorMessage %>
							<% } %>
						</div>
						<p class="text-danger" id="error-message"></p>
					</div>
				</form>
				
				

			</div>
		  </div>
		  <div class="card shadow-0 border">
			<div class="card-body">
			<div class="d-flex justify-content-between">
			  
			  <!-- Add this element in the HTML where you want to display the total price -->
			  <form action="/user/cart" method="post" style="text-align: left;">
				<p class="mb-2" id="tot" >Total price of products:₹<%=total%></p>

				<p class="mb-2" id="couponDiscount">Coupon Discount: ₹0</p>

				  
					
				<hr />
<div id="totalPriceDisplay">Total Amount:₹<span id="totalPriceValue"><%=total%></span></div>
         <input type="hidden" id="tota" name="totalAmount" value="<%=total%>">

			</div>

			<hr />
			
			<div class="mt-3">
				<button class="btn btn-success w-100 shadow-0 mb-2">Check Out</button>
			  
			  <a href="/" class="btn btn-light w-100 border mt-2"> Back to shop </a>
			</div>
		</form>
		  </div>
		</div>
	  </div>
	
      <!-- Other sections of the cart page can be added here -->
    </div>
  </div>
  

  <% } %>





</section>
<!-- cart + summary -->

  <!-- cart + summary -->


  <section>
	<div class="container my-5">
	  <header class="mb-4">
		<h3>Recommended items</h3>
	  </header>
  
	  <div class="row">
		<%product.forEach((pro)=>{%>

		
		<div class="col-lg-3 col-md-6 col-sm-6">
		  <div class="card px-4 border shadow-0 mb-4 mb-lg-0">
			<div class="mask px-2" style="height: 50px;">
			  <div class="d-flex justify-content-between">
				<h6><span class="badge bg-danger pt-1 mt-3 ms-2">New</span></h6>
				<a href="#"><i class="fas fa-heart text-primary fa-lg float-end pt-3 m-2"></i></a>
			  </div>
			</div>
			<a href="#" class="">
				<img class="img-responsive zoom-img" src="/productimg/<%= pro.image.length > 0 ? pro.image[0] : 'default-image.jpg' %>" alt="<%= pro.image %>" style="width: 80px%; height: 160px;" />
			</a>
			<div class="card-body d-flex flex-column pt-3 border-top">
			  <a href="#" class="nav-link"><%=pro.name%></a>
			  <div class="price-wrap mb-2">
				<strong class="">₹<%=pro.price%></strong>
				
			  </div>
			  <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
				<a href="#" class="btn btn-outline-primary w-100">View Details</a>
			  </div>
			</div>
		  </div>
		</div>
		<%})%>
	  </div>
	</div>
  </section>
  <!-- Recommended -->
  
  <!-- Footer -->
  <footer class="text-center text-lg-start text-muted bg-black mt-3">
	<!-- Section: Links  -->
	<section class="">
	  <div class="container text-center text-md-start pt-4 pb-4">
		<!-- Grid row -->
		<div class="row mt-3">
		  <!-- Grid column -->
		  <div class="col-12 col-lg-3 col-sm-12 mb-2">
			<!-- Content -->
			<a href="https://mdbootstrap.com/" target="_blank" class="text-white h2">
			  WatchBox
			</a>
			<p class="mt-1 text-white">
			  
			</p>
		  </div>
		  <!-- Grid column -->
  
		  <!-- Grid column -->
		  <div class="col-6 col-sm-4 col-lg-2">
			<!-- Links -->
			<h6 class="text-uppercase text-white fw-bold mb-2">
			  Store
			</h6>
			<ul class="list-unstyled mb-4">
			  <li><a class="text-white-50" href="#">About us</a></li>
			  <li><a class="text-white-50" href="#">Find store</a></li>
			  <li><a class="text-white-50" href="#">Categories</a></li>
			  <li><a class="text-white-50" href="#">Blogs</a></li>
			</ul>
		  </div>
		  <!-- Grid column -->
  
		  <!-- Grid column -->
		  <div class="col-6 col-sm-4 col-lg-2">
			<!-- Links -->
			<h6 class="text-uppercase text-white fw-bold mb-2">
			  Information
			</h6>
			<ul class="list-unstyled mb-4">
			  <li><a class="text-white-50" href="#">Help center</a></li>
			  <li><a class="text-white-50" href="#">Money refund</a></li>
			  <li><a class="text-white-50" href="#">Shipping info</a></li>
			  <li><a class="text-white-50" href="#">Refunds</a></li>
			</ul>
		  </div>
		  <!-- Grid column -->
  
		  <!-- Grid column -->
		  <div class="col-6 col-sm-4 col-lg-2">
			<!-- Links -->
			<h6 class="text-uppercase text-white fw-bold mb-2">
			  Support
			</h6>
			<ul class="list-unstyled mb-4">
			  <li><a class="text-white-50" href="#">Help center</a></li>
			  <li><a class="text-white-50" href="#">Documents</a></li>
			  <li><a class="text-white-50" href="#">Account restore</a></li>
			  <li><a class="text-white-50" href="#">My orders</a></li>
			</ul>
		  </div>
		  <!-- Grid column -->
  
		  <!-- Grid column -->
		  <div class="col-12 col-sm-12 col-lg-3">
			<!-- Links -->
			<h6 class="text-uppercase text-white fw-bold mb-2">Newsletter</h6>
			<p class="text-white">Stay in touch with latest updates about our products and offers</p>
			<div class="input-group mb-3">
			  <input type="email" class="form-control border" placeholder="Email" aria-label="Email" aria-describedby="button-addon2" />
			  <button class="btn btn-light border shadow-0" type="button" id="button-addon2" data-mdb-ripple-color="dark">
				Join
			  </button>
			</div>
		  </div>
		  <!-- Grid column -->
		</div>
		<!-- Grid row -->
	  </div>
	</section>
	<!-- Section: Links  -->
  
	<div class="">
	  <div class="container">
		<div class="d-flex justify-content-between py-4 border-top">
		  <!--- payment --->
		  <div>
			<i class="fab fa-lg fa-cc-visa text-white"></i>
			<i class="fab fa-lg fa-cc-amex text-white"></i>
			<i class="fab fa-lg fa-cc-mastercard text-white"></i>
			<i class="fab fa-lg fa-cc-paypal text-white"></i>
		  </div>
		  <!--- payment --->
  
		  <!--- language selector --->
		  <div class="dropdown dropup">
			<a class="dropdown-toggle text-white" href="#" id="Dropdown" role="button" data-mdb-toggle="dropdown" aria-expanded="false"> <i class="flag-united-kingdom flag m-0 me-1"></i>English </a>
  
			<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="Dropdown">
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-united-kingdom flag"></i>English <i class="fa fa-check text-success ms-2"></i></a>
			  </li>
			  <li><hr class="dropdown-divider" /></li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-poland flag"></i>Polski</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-china flag"></i>中文</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-japan flag"></i>日本語</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-germany flag"></i>Deutsch</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-france flag"></i>Français</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-spain flag"></i>Español</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-russia flag"></i>Русский</a>
			  </li>
			  <li>
				<a class="dropdown-item" href="#"><i class="flag-portugal flag"></i>Português</a>
			  </li>
			</ul>
		  </div>
		  <!--- language selector --->
		</div>
	  </div>
	</div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script>
	
const totalPriceElement = document.getElementById('totalPriceValue');

if (totalPriceElement) {
  totalPriceElement.textContent = totalPrice; // Update the displayed total price
}

function increaseValue(productId,price) {
    let currentValue = parseInt(document.getElementById('number_' + productId).value, 10);
    const newQuantity = currentValue + 1;
	document.getElementById("totalPriceValue").innerHTML=newQuantity*price
    updateQuantity(productId, newQuantity);
      
    document.getElementById('number_' + productId).value = newQuantity;
	// calculateTotalPrice();
	
  }
   
  function decreaseValue(productId,price) {
    let currentValue = parseInt(document.getElementById('number_' + productId).value, 10);
    const newQuantity = currentValue > 1 ? currentValue - 1 : 1;
	document.getElementById("totalPriceValue").innerHTML=newQuantity*price
    updateQuantity(productId, newQuantity);
    document.getElementById('number_' + productId).value = newQuantity;
	// calculateTotalPrice();
  }

  async function updateQuantity(productId, quantity) {
    try {
      const response = await fetch(`/cart/update/${productId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ quantity }),
      });
      if (response.ok) {
        
      } else {
        const responseData = await response.json();
        if (responseData.message) {
                alert(responseData.message); // Display the message to the user
            }
      }
	  window.location.reload()
    } catch (error) {
      console.error('Error:', error);
    }
  }

  
///////////////////////////////
///////////total//////////////

 </script>
<script>
    const applyButton = document.getElementById("buttons");

    applyButton.addEventListener("click", async function () {
        const couponCode = document.getElementById("couponid").value;
        const total = document.getElementById("tot").innerText.split("₹")[1].trim();
		const couponDiscountElement = document.getElementById("couponDiscount");
        try {
            const response = await fetch(`/apply-coupon?code=${couponCode}&total=${total}`);
            const data = await response.json();

            if (data.success) {
                document.getElementById("totalPriceValue").innerText = data.newTotal;
                document.getElementById("tota").value = data.newTotal;

				couponDiscountElement.innerText = `Coupon Discount: ₹${data.discountAmount}`;

                document.getElementById("success-message").style.display = 'block';
                applyButton.innerText = "Remove"; // Change button text to "Remove"
            } else {
                document.getElementById("error-message").innerText = data.message;
                document.getElementById("success-message").style.display = 'none';
            }
        } catch (error) {
            console.error("Error applying coupon:", error);
        }
    });

    // Add event listener to reload the page when "Remove" button is clicked
    applyButton.addEventListener("click", function () {
        if (applyButton.innerText === "Remove") {
            location.reload();
        }
    });
</script>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	
	<script>
        function copyCouponCode() {
            // Coupon code to copy
            var couponCode = "off123";

            // Create a temporary textarea element to copy the text
            var tempTextarea = document.createElement("textarea");
            tempTextarea.value = couponCode;

            // Append the textarea to the DOM
            document.body.appendChild(tempTextarea);

            // Select and copy the text
            tempTextarea.select();
            document.execCommand("copy");

            // Remove the textarea from the DOM
            document.body.removeChild(tempTextarea);

            // Use SweetAlert for a more visually appealing alert
            Swal.fire({
                icon: 'success',
                title: 'Coupon Code Copied!',
                text: couponCode + ' has been copied to your clipboard.',
                showConfirmButton: false,
                timer: 1000
            });
        }
    </script>
	<script>
        function copyCouponCod() {
            // Coupon code to copy
            var couponCode = "Offer321";

            // Create a temporary textarea element to copy the text
            var tempTextarea = document.createElement("textarea");
            tempTextarea.value = couponCode;

            // Append the textarea to the DOM
            document.body.appendChild(tempTextarea);

            // Select and copy the text
            tempTextarea.select();
            document.execCommand("copy");

            // Remove the textarea from the DOM
            document.body.removeChild(tempTextarea);

            // Use SweetAlert for a more visually appealing alert
            Swal.fire({
                icon: 'success',
                title: 'Coupon Code Copied!',
                text: couponCode + ' has been copied to your clipboard.',
                showConfirmButton: false,
                timer: 1000
            });
        }
    </script>

</body>
</body>
</html>